# Install FFmpeg on EC2 instance
# This is required for audio processing and Whisper transcription

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_install_ffmpeg.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Install FFmpeg on Amazon Linux 2023
      
      if ! command -v ffmpeg &> /dev/null; then
        echo "Installing FFmpeg..."
        
        # For Amazon Linux 2023
        sudo dnf install -y epel-release
        sudo dnf install -y https://download1.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpm
        sudo dnf install -y ffmpeg ffmpeg-devel
        
        # Verify installation
        if command -v ffmpeg &> /dev/null; then
          echo "FFmpeg installed successfully"
          ffmpeg -version
        else
          echo "Warning: FFmpeg installation may have failed"
        fi
      else
        echo "FFmpeg already installed"
        ffmpeg -version
      fi
