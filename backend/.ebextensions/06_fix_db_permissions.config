container_commands:
  01_fix_db_permissions:
    command: |
      # Fix database file and directory permissions
      # Ensure the directory is writable
      chmod 775 /var/app/current || true
      # Fix database file permissions if it exists
      if [ -f /var/app/current/db.sqlite3 ]; then
        chmod 664 /var/app/current/db.sqlite3 || true
        chown webapp:webapp /var/app/current/db.sqlite3 2>/dev/null || true
      fi
      # Ensure directory ownership (may fail if already correct, that's OK)
      chown webapp:webapp /var/app/current 2>/dev/null || true
    leader_only: false
